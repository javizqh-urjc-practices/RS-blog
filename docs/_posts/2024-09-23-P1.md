---
title: "P1: Localized Vacuum Cleaner"
date: 2024-09-23 18:00:00 +0100
tags: [weekly progress]     # TAG names should always be lowercase
author: javier
img_path: /assets/img/
toc: true
comments: true
pin: true
---

## Fitting the map

## Planning the path

## Movement

Instead of having 2 types of movement control: Go Forward and Rotate. I chose a to manage the movement as 1 single movement.

Thanks to the way the path is created, the vacuum only needs to move to the interest points (where the vacuum changes direction) I can simplify the movement into 2 parts of a single function.

1. Spin until the yaw of the vacuum matches the angle define by the inverse tangent of the distance in both axis to the point of interest.

```python
pose = HAL.getPose3d()
ang = math.degrees(math.atan((dest_y - pose.y)/(dest_x - pose.x)))

# Consider arctan symbol problems
if (dest_x - pose.x) < 0:
  if (dest_y - pose.y) < 0:
    ang -= 180
  else:
    ang += 180
```

2. Go forward until a certain threshold is met, in this case 15 cm.

In order to not fake any vacuum cleaning, I only paint as green the cells where the vacuum is in.

```python
pose = HAL.getPose3d()
x, y = pose_to_grid(pose)
clean_cell(x,y, grid, matrix)
```


## Issues during development

The main issue I encounter during the development was to not erode the main image. Why was this important?

Well, because of the size of the cell being 32.6 px and the vacuum being 35 px in some extreme cases the center of the cell was not reacheable and the vacuum crashed.

To solve this I eroded the image with a 5x5 kernel after resizing it to 527x527 and this solved the problem. The downside was now that the cleaning area was reduced by around 10%.

## Videos

The videos are at 10X speed, so the time it takes to clean the full house is around 30 minutes.

{% include embed/youtube.html id='cQF3FXRTKrs' %}

{% include embed/youtube.html id='7dwxaS7Arx0' %}
